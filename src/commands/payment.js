(function(_0xfc7afb,_0x371a2f){const _0x304747=a0_0x1cfa,_0x3f6dd8=_0xfc7afb();while(!![]){try{const _0x553bdd=parseInt(_0x304747(0x163))/0x1+-parseInt(_0x304747(0x174))/0x2*(parseInt(_0x304747(0x17d))/0x3)+parseInt(_0x304747(0x171))/0x4+-parseInt(_0x304747(0x13d))/0x5*(parseInt(_0x304747(0x17e))/0x6)+-parseInt(_0x304747(0x14f))/0x7+parseInt(_0x304747(0x15f))/0x8+parseInt(_0x304747(0x141))/0x9;if(_0x553bdd===_0x371a2f)break;else _0x3f6dd8['push'](_0x3f6dd8['shift']());}catch(_0xf5166d){_0x3f6dd8['push'](_0x3f6dd8['shift']());}}}(a0_0x1ffe,0xcf341));const a0_0x7be20=a0_0x4b66;(function(_0x519384,_0x1fc323){const _0x5dcce5=a0_0x1cfa,_0x10afbd=a0_0x4b66,_0x142259=_0x519384();while(!![]){try{const _0x2ff786=parseInt(_0x10afbd(0xd3))/0x1*(parseInt(_0x10afbd(0xa8))/0x2)+-parseInt(_0x10afbd(0xac))/0x3*(-parseInt(_0x10afbd(0xb6))/0x4)+parseInt(_0x10afbd(0xdf))/0x5*(parseInt(_0x10afbd(0xe9))/0x6)+-parseInt(_0x10afbd(0xd2))/0x7*(parseInt(_0x10afbd(0xe3))/0x8)+parseInt(_0x10afbd(0xe1))/0x9+-parseInt(_0x10afbd(0xf8))/0xa+-parseInt(_0x10afbd(0xd4))/0xb*(parseInt(_0x10afbd(0xbb))/0xc);if(_0x2ff786===_0x1fc323)break;else _0x142259[_0x5dcce5(0x135)](_0x142259[_0x5dcce5(0x13b)]());}catch(_0x3897d1){_0x142259[_0x5dcce5(0x135)](_0x142259[_0x5dcce5(0x13b)]());}}}(a0_0x35fa,0x65ed3));function a0_0x1ffe(){const _0x331be7=['completed','âœ…\x20Receipt\x20sent\x20to\x20customer:\x20','production','Lipana\x20STK\x20Push\x20Error:','toString','N/A','PAYMENT_CALLBACK_URL\x20not\x20set\x20-\x20using\x20default\x20Lipana\x20callback\x20handling','orderId','success','6612480xVvDRN','\x0aâ”œâ”€\x20Link:\x20','status','62654Rzaeeq','Error\x20sending\x20payment\x20verification\x20to\x20admin:','mpesaReceiptNumber','toISOString','254759424232@s.whatsapp.net','242uaywUe','mpesaRef','â”œâ”€\x20M-PESA\x20Ref:\x20','âš¡\x20*ACTION:\x20Payment\x20verified\x20-\x20proceed\x20with\x20service\x20delivery*','141mMKmTn','36ZpxerO','checkoutRequestID','SUCCESS','Payment\x20system\x20not\x20configured','Error\x20sending\x20receipt\x20to\x20customer:','/=\x20KES\x0aâ”œâ”€\x20Phone\x20Number:\x20','235380jaSKDO','completedAt','exports','1125iotBPe','sandbox','\x0aâ”œâ”€\x20Amount:\x20','\x0aâ”œâ”€\x20Date\x20&\x20Time:\x20','env','\x0a\x0ağŸ’³\x20*Payment\x20Summary:*\x0aâ”œâ”€\x20Amount\x20Paid:\x20','transactions','delete','\x20*PAYMENT\x20VERIFICATION*\x0aâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\x0a\x0ağŸ“‹\x20*Transaction\x20Details:*\x0aâ”œâ”€\x20Order\x20ID:\x20','78KagxtP','â”œâ”€\x20M-PESA\x20Receipt:\x20','phone','set','\x0aâ”œâ”€\x20Reference:\x20','Africa/Nairobi','90456mdxtyu','service','\x20mode','push','initiateStkPush','Initializing\x20Lipana\x20in\x20','21oDOtCH','â”œâ”€\x20Transaction\x20ID:\x20','amount','shift','startsWith','540670cWFund','Payment\x20initiation\x20failed','workflowId','âš ï¸\x20*ACTION:\x20Payment\x20failed\x20-\x20contact\x20customer\x20for\x20resolution*','15751584BnonZE','link','platform','2592099nceMPP','âœ…\x20*PAYMENT\x20CONFIRMED\x20-\x20RECEIPT*\x0aâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\x0a\x0ağŸ‰\x20*Your\x20payment\x20has\x20been\x20successfully\x20received!*\x0a\x0ağŸ“‹\x20*Receipt\x20Details:*\x0aâ”œâ”€\x20Order\x20ID:\x20','LIPANA_ENV','779432MNFBwE','transactionId','\x0aâ”œâ”€\x20Payment\x20Status:\x20','pending','Payment\x20system\x20not\x20configured.\x20Contact\x20admin\x20to\x20set\x20up\x20LIPANA_SECRET_KEY','\x0aâ”œâ”€\x20Transaction\x20Ref:\x20','get','âœ…\x20Payment\x20verification\x20sent\x20to\x20admin:\x20','7876365nlzOxz','customerJid','254','log','\x0a\x0ağŸ’³\x20*Payment\x20Information:*\x0aâ”œâ”€\x20Phone:\x20','@s.whatsapp.net','error','\x0aâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\x0a\x0a','warn','LIPANA_SECRET_KEY','message','\x0aâ”œâ”€\x20Service:\x20','Bot\x20socket\x20not\x20available\x20for\x20payment\x20verification\x20notification','Bot\x20socket\x20not\x20available\x20for\x20customer\x20receipt','en-KE','sendMessage','4885992RXIolF','âœ…\x20SUCCESS','STK\x20Push\x20sent\x20successfully','qty','81028yIvqWJ','Payment\x20verification\x20error:','PAYMENT_CALLBACK_URL','TRUE\x20âœ“','\x0aâ”œâ”€\x20Time:\x20'];a0_0x1ffe=function(){return _0x331be7;};return a0_0x1ffe();}const {Lipana}=require('@lipana/sdk');let lipana=null,botSocket=null;const ADMIN_NUMBERS=['254745282166@s.whatsapp.net',a0_0x7be20(0xad)];function setBotSocket(_0x37d131){botSocket=_0x37d131;}function initLipana(){const _0x1cbff3=a0_0x1cfa,_0x160675=a0_0x7be20;if(!process[_0x160675(0xaa)][_0x160675(0xa2)])return console[_0x160675(0x97)](_0x160675(0xc9)),null;const _0x1d0b82=process[_0x1cbff3(0x18b)][_0x160675(0xe2)]===_0x160675(0xf4)?'sandbox':_0x1cbff3(0x16a);return console[_0x160675(0xa9)](_0x160675(0xee)+_0x1d0b82+_0x1cbff3(0x134)),new Lipana({'apiKey':process[_0x160675(0xaa)][_0x160675(0xa2)],'environment':_0x1d0b82});}lipana=initLipana();const pendingPayments=new Map();function a0_0x1cfa(_0x290618,_0x4439ca){_0x290618=_0x290618-0x130;const _0x1ffeb4=a0_0x1ffe();let _0x1cfa0e=_0x1ffeb4[_0x290618];return _0x1cfa0e;}async function initiateSTKPush(_0x38504f,_0x48d67a,_0x5732ac,_0x491ba8=null,_0x40af58=null){const _0x119c75=a0_0x1cfa,_0x372191=a0_0x7be20;!lipana&&(lipana=initLipana());if(!lipana)throw new Error(_0x372191(0xdd));let _0x19c2bf=_0x38504f[_0x372191(0xf5)]()[_0x372191(0xf1)](/\s+/g,'')[_0x372191(0xf1)](/[^0-9]/g,'');if(_0x19c2bf[_0x372191(0xbf)]('0'))_0x19c2bf=_0x372191(0xba)+_0x19c2bf[_0x372191(0xb4)](0x1);else!_0x19c2bf[_0x119c75(0x13c)](_0x372191(0xba))&&(_0x19c2bf=_0x372191(0xba)+_0x19c2bf);const _0x55788f=process[_0x372191(0xaa)][_0x372191(0xf6)];!_0x55788f&&console['warn'](_0x372191(0xc8));try{const _0x4c83f5=await lipana[_0x372191(0xa7)][_0x372191(0x9d)]({'phone':_0x19c2bf,'amount':Number(_0x48d67a),'callbackUrl':_0x55788f}),_0x4242a8=_0x4c83f5[_0x372191(0xc4)]||_0x4c83f5[_0x372191(0xae)]||_0x4c83f5[_0x372191(0xaf)];return pendingPayments['set'](_0x4242a8,{'orderId':_0x5732ac,'phone':_0x19c2bf,'amount':_0x48d67a,'status':_0x372191(0xcd),'timestamp':Date[_0x372191(0xbe)](),'customerJid':_0x491ba8,..._0x40af58&&{'platform':_0x40af58[_0x372191(0xb3)],'service':_0x40af58[_0x372191(0xa4)],'qty':_0x40af58[_0x372191(0xd1)],'link':_0x40af58[_0x372191(0xdc)]}}),{'success':!![],'reference':_0x4242a8,'message':_0x372191(0xda)};}catch(_0x384c98){return console[_0x372191(0xd7)](_0x372191(0xc7),_0x384c98),{'success':![],'error':_0x384c98[_0x372191(0xdb)]||_0x372191(0xec)};}}function getPendingPayment(_0x5ca352){const _0x92e820=a0_0x7be20;return pendingPayments[_0x92e820(0xca)](_0x5ca352);}async function updatePaymentStatus(_0x2d4b28,_0x33f34f,_0x50caec={}){const _0x58602a=a0_0x7be20,_0x5dc796=pendingPayments[_0x58602a(0xca)](_0x2d4b28);_0x5dc796&&(_0x5dc796[_0x58602a(0xbc)]=_0x33f34f,_0x5dc796[_0x58602a(0x95)]=Date[_0x58602a(0xbe)](),_0x5dc796[_0x58602a(0x96)]=_0x50caec,pendingPayments[_0x58602a(0x99)](_0x2d4b28,_0x5dc796),(_0x33f34f===_0x58602a(0xb7)||_0x33f34f===_0x58602a(0xbd))&&await sendPaymentVerificationToAdmin(_0x5dc796,_0x2d4b28,_0x50caec));}async function sendPaymentVerificationToAdmin(_0x5484b4,_0x13923d,_0x3168bc){const _0x11e27c=a0_0x1cfa,_0x291e3a=a0_0x7be20;if(!botSocket){console[_0x11e27c(0x155)](_0x291e3a(0xd0));return;}const _0x2b1adb=new Date()[_0x291e3a(0xfb)](_0x291e3a(0xf2),{'timeZone':_0x291e3a(0x98)}),_0x2312e7=_0x5484b4[_0x291e3a(0xbc)]===_0x291e3a(0xb7)||_0x5484b4[_0x291e3a(0xbc)]===_0x291e3a(0xbd)?_0x291e3a(0xea):_0x291e3a(0xf3),_0x465525=_0x5484b4[_0x291e3a(0xbc)]===_0x291e3a(0xb7)||_0x5484b4[_0x291e3a(0xbc)]===_0x291e3a(0xbd)?'âœ…':'âŒ',_0x1366b6=_0x465525+_0x291e3a(0xe0)+(_0x5484b4[_0x11e27c(0x16f)]||_0x291e3a(0xb9))+_0x291e3a(0xa0)+_0x13923d+_0x291e3a(0xb2)+_0x2b1adb+_0x11e27c(0x153)+_0x5484b4[_0x11e27c(0x192)]+_0x291e3a(0xf9)+_0x5484b4[_0x291e3a(0xb8)]+_0x291e3a(0xe4)+_0x2312e7+_0x291e3a(0xa5)+(_0x5484b4[_0x291e3a(0xbc)]===_0x11e27c(0x170)||_0x5484b4['status']===_0x291e3a(0xbd)?_0x291e3a(0xed):_0x291e3a(0xcc))+'\x0a\x0a'+(_0x3168bc[_0x291e3a(0xaf)]?_0x11e27c(0x139)+_0x3168bc[_0x291e3a(0xaf)]+'\x0a':'')+(_0x3168bc[_0x291e3a(0xa6)]?_0x291e3a(0x9b)+_0x3168bc[_0x291e3a(0xa6)]+'\x0a':'')+(_0x5484b4[_0x291e3a(0xb3)]?'\x0ağŸ“¦\x20*Service\x20Details:*\x0aâ”œâ”€\x20Platform:\x20'+_0x5484b4[_0x291e3a(0xb3)]+_0x11e27c(0x15a)+_0x5484b4[_0x291e3a(0xd1)]+'\x20'+_0x5484b4[_0x291e3a(0xa4)]+_0x291e3a(0xc3)+_0x5484b4[_0x291e3a(0xdc)]+'\x0a':'')+_0x291e3a(0xc1)+(_0x5484b4[_0x291e3a(0xbc)]===_0x291e3a(0xb7)||_0x5484b4[_0x291e3a(0xbc)]===_0x11e27c(0x168)?_0x291e3a(0x9f):_0x291e3a(0xfc))+_0x291e3a(0xe8);try{for(const _0x4727f2 of ADMIN_NUMBERS){await botSocket[_0x291e3a(0xd9)](_0x4727f2,{'text':_0x1366b6}),console[_0x291e3a(0xa9)](_0x291e3a(0xb1)+_0x4727f2);}(_0x5484b4[_0x11e27c(0x173)]===_0x291e3a(0xb7)||_0x5484b4[_0x291e3a(0xbc)]===_0x291e3a(0xbd))&&await sendCustomerReceipt(_0x5484b4,_0x13923d,_0x3168bc);}catch(_0x1cabd5){console[_0x291e3a(0xd7)](_0x291e3a(0xe5),_0x1cabd5);}}async function sendCustomerReceipt(_0x6088d2,_0x42c4cb,_0x5d5be5){const _0x246931=a0_0x1cfa,_0x420bb3=a0_0x7be20;if(!botSocket){console[_0x420bb3(0xd7)](_0x246931(0x15c));return;}const _0x244f70=new Date()[_0x420bb3(0xfb)](_0x246931(0x15d),{'timeZone':_0x420bb3(0x98)});let _0x2ae1b5=_0x6088d2[_0x420bb3(0x9c)];!_0x2ae1b5&&_0x6088d2[_0x420bb3(0xc2)]&&(_0x2ae1b5=_0x6088d2[_0x420bb3(0xc2)]+_0x420bb3(0xcb));if(!_0x2ae1b5){console['error'](_0x420bb3(0xa3));return;}const _0x54fc3f=_0x246931(0x145)+(_0x6088d2[_0x420bb3(0x9e)]||_0x420bb3(0xb9))+_0x420bb3(0xd5)+_0x42c4cb+_0x420bb3(0xfa)+_0x244f70+_0x420bb3(0xa1)+_0x6088d2[_0x420bb3(0xb8)]+_0x420bb3(0xc5)+_0x6088d2[_0x420bb3(0xc2)]+'\x0a'+(_0x5d5be5[_0x420bb3(0xa6)]?_0x420bb3(0xd8)+_0x5d5be5[_0x420bb3(0xa6)]+'\x0a':'')+(_0x5d5be5[_0x420bb3(0xaf)]?_0x420bb3(0xe7)+_0x5d5be5[_0x420bb3(0xaf)]+'\x0a':'')+_0x420bb3(0xeb);try{await botSocket[_0x420bb3(0xd9)](_0x2ae1b5,{'text':_0x54fc3f}),console[_0x420bb3(0xa9)](_0x420bb3(0xab)+_0x2ae1b5);}catch(_0x5e24b3){console[_0x420bb3(0xd7)](_0x420bb3(0x9a),_0x5e24b3),console[_0x420bb3(0xa9)](_0x420bb3(0xde));}}async function verifyPayment(_0x118cc2){const _0x24b58a=a0_0x1cfa,_0x178f49=a0_0x7be20;!lipana&&(lipana=initLipana());if(!lipana)throw new Error(_0x178f49(0xf0));try{const _0x5bdd68=await lipana[_0x24b58a(0x18d)]['query']({'reference':_0x118cc2}),_0x2d4fa6={'transactionId':_0x5bdd68[_0x178f49(0xaf)]||_0x5bdd68['id'],'mpesaRef':_0x5bdd68[_0x178f49(0xce)]||_0x5bdd68[_0x178f49(0xd6)],'amount':_0x5bdd68[_0x178f49(0xb8)],'status':_0x5bdd68[_0x178f49(0xbc)],'completedAt':_0x5bdd68[_0x24b58a(0x185)]||new Date()[_0x178f49(0xef)]()},_0x195690=_0x5bdd68[_0x178f49(0xbc)]===_0x178f49(0xb5)||_0x5bdd68[_0x24b58a(0x173)]===_0x178f49(0xc6)||_0x5bdd68[_0x24b58a(0x173)]===_0x24b58a(0x170);return await updatePaymentStatus(_0x118cc2,_0x195690?_0x178f49(0xb7):_0x178f49(0xf7),_0x2d4fa6),{'success':_0x195690,'details':_0x2d4fa6};}catch(_0x4ffd14){return console[_0x178f49(0xd7)](_0x178f49(0xc0),_0x4ffd14),{'success':![],'error':_0x4ffd14[_0x24b58a(0x159)]};}}function a0_0x4b66(_0x135fef,_0x5f5db4){_0x135fef=_0x135fef-0x95;const _0x453f8=a0_0x35fa();let _0x5a3b77=_0x453f8[_0x135fef];return _0x5a3b77;}function clearExpiredPayments(){const _0x32e33a=a0_0x7be20,_0x2a101b=Date[_0x32e33a(0xbe)](),_0x23d005=0xa*0x3c*0x3e8;for(const [_0x1584de,_0x34c97b]of pendingPayments){_0x2a101b-_0x34c97b[_0x32e33a(0xe6)]>_0x23d005&&pendingPayments[_0x32e33a(0xcf)](_0x1584de);}}function a0_0x35fa(){const _0x5e35ca=a0_0x1cfa,_0x25480c=[_0x5e35ca(0x18a),'toLocaleString',_0x5e35ca(0x140),_0x5e35ca(0x185),'paymentDetails',_0x5e35ca(0x157),_0x5e35ca(0x131),_0x5e35ca(0x193),_0x5e35ca(0x182),_0x5e35ca(0x17b),_0x5e35ca(0x150),_0x5e35ca(0x136),_0x5e35ca(0x16f),_0x5e35ca(0x17c),_0x5e35ca(0x130),_0x5e35ca(0x18c),_0x5e35ca(0x158),'Unable\x20to\x20determine\x20customer\x20JID\x20for\x20receipt',_0x5e35ca(0x133),_0x5e35ca(0x149),_0x5e35ca(0x17a),_0x5e35ca(0x18d),_0x5e35ca(0x190),_0x5e35ca(0x152),_0x5e35ca(0x18b),_0x5e35ca(0x169),_0x5e35ca(0x187),_0x5e35ca(0x178),_0x5e35ca(0x17f),_0x5e35ca(0x148),_0x5e35ca(0x186),_0x5e35ca(0x14e),_0x5e35ca(0x167),_0x5e35ca(0x143),'substring',_0x5e35ca(0x180),'5812YmtVCW',_0x5e35ca(0x170),_0x5e35ca(0x13a),_0x5e35ca(0x16d),_0x5e35ca(0x151),_0x5e35ca(0x132),_0x5e35ca(0x173),_0x5e35ca(0x168),'now',_0x5e35ca(0x13c),_0x5e35ca(0x164),_0x5e35ca(0x156),_0x5e35ca(0x192),_0x5e35ca(0x172),_0x5e35ca(0x13f),_0x5e35ca(0x183),'COMPLETED',_0x5e35ca(0x16b),_0x5e35ca(0x16e),'LIPANA_SECRET_KEY\x20not\x20set\x20-\x20payment\x20features\x20will\x20not\x20work',_0x5e35ca(0x14d),_0x5e35ca(0x154),'FALSE\x20âœ—',_0x5e35ca(0x14a),_0x5e35ca(0x176),_0x5e35ca(0x18e),_0x5e35ca(0x15b),_0x5e35ca(0x162),_0x5e35ca(0x138),'7723UoyvtC',_0x5e35ca(0x179),_0x5e35ca(0x14c),'receiptNumber','error',_0x5e35ca(0x191),_0x5e35ca(0x15e),_0x5e35ca(0x161),_0x5e35ca(0x159),_0x5e35ca(0x142),_0x5e35ca(0x14b),'Failed\x20to\x20send\x20receipt\x20via\x20phone\x20number\x20JID','10dVmtlq',_0x5e35ca(0x18f),_0x5e35ca(0x144),_0x5e35ca(0x146),_0x5e35ca(0x147),'/=\x20KES\x0aâ”œâ”€\x20Status:\x20',_0x5e35ca(0x175),'timestamp',_0x5e35ca(0x139),'\x0a\x0aâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\x0ağŸ¤–\x20MADARA\x20UCHIHA\x20Payment\x20System',_0x5e35ca(0x184),_0x5e35ca(0x160),'â”œâ”€\x20Status:\x20âœ…\x20CONFIRMED\x0a\x0aâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\x0a\x0aâš¡\x20*What\x27s\x20Next?*\x0aYour\x20order\x20is\x20being\x20processed\x20and\x20will\x20be\x20delivered\x20within\x20a\x20few\x20minutes.\x0a\x0ağŸ“\x20*Need\x20Help?*\x0aContact\x20support:\x20254745282166\x20or\x20254759424232\x0a\x0aThank\x20you\x20for\x20your\x20business!\x20ğŸ™\x0a\x0aâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\x0ağŸ¤–\x20MADARA\x20UCHIHA\x20Bot',_0x5e35ca(0x13e),_0x5e35ca(0x166),_0x5e35ca(0x137),_0x5e35ca(0x177),_0x5e35ca(0x181),'replace',_0x5e35ca(0x15d),'âŒ\x20FAILED',_0x5e35ca(0x188),_0x5e35ca(0x16c),_0x5e35ca(0x165),'failed','3369290ePvFXt',_0x5e35ca(0x189)];return a0_0x35fa=function(){return _0x25480c;},a0_0x35fa();}setInterval(clearExpiredPayments,0xea60),module[a0_0x7be20(0xb0)]={'initiateSTKPush':initiateSTKPush,'getPendingPayment':getPendingPayment,'updatePaymentStatus':updatePaymentStatus,'verifyPayment':verifyPayment,'setBotSocket':setBotSocket,'pendingPayments':pendingPayments,'sendCustomerReceipt':sendCustomerReceipt};